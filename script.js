const defaultConfig = {
  opening_message: "FOR YOU",
  letter_recipient: "MM",
  letter_content:
    "আহহ, বাংলা লেখা কত প্যারা! তার উপর আবার Office ফ্রি ইউজ করতে দেয় না—আরেক প্যারা। তাই ভাবলাম, চিঠি না দিয়ে একটা ওয়েবসাইটই বানিয়ে দিই। সেরা না? হিহি। তোমার জন্য বুদ্ধি বাড়ছে আমার। (বানান ভুল হলে সরি হু?)\n\nশুনো, তুমি আমার কাছে কী—তা তুমি খুব ভালো করেই জানো। আমি তোমাকে কতটা ভালোবাসি, সেটাও জানো। নতুন করে আর কী বলতাম? এটাও জানো, কোন কোন কথায় আমার খারাপ লাগে—এটা তুমি আরও ভালো জানো (হিহি)।\n\nতোমাকে আমি তেমন কিছু দিতে পারিনি—বা পারি না—যা তুমি সত্যিই deserve করো। সত্যি বলতে, মাঝে মাঝে ভয়ও হয়, আমি কিছু দিলে তোমার পছন্দ হবে তো?\n\nআবার দেখো, একবার পছন্দও হয়েছিল… আর আমি রাজশাহীতে রেখে এসেছিলাম। বলদ আমি।\n\nতাই ভাবলাম, চিঠি না দিয়ে বরং একটা আবেদনপত্রই দিই। কী বলো?\n\nতারিখ: ৩০/১২/২০২৫\n\nবরাবর,\n\nTHE FINAL BOSS\n\nবিষয়: ইনফিনিটি সংখ্যক আবেদন\n\nশুরুতেই বলি—আমি আপনাকে অনেক ভালোবাসি। এই যে যেগুলো কিনলেন, আমি চাই আপনি আমাকে ছবি তুলে পাঠান—অনেএএএকগুলো। না হলে আমাকে ডাকবেন, আমি এসে নিজেই তুলে নেব। আপনি ভাবতেও পারবেন না—আমার চোখে আপনি কতটা সুন্দর। নিজেকে আমার চোখে একবার দেখলে বুঝতেন।\n\nশুনুন, আপনার সাথে আমার কাউকে সহ্য হয় না—ওই কালো ভটকা হোক বা আপনার ওই ফ্রেন্ড। বিশেষ করে ওই ফ্রেন্ডটাকে। এই লিখতেও ওসব ছবি মাথায় ঘুরছে—ধুর।\n\nআপনাকে কেউ না দেখে, শুধু আমি দেখলে—আরও ভালো হতো। আর ওই যে… কী নাম যেন—বিলাল না বাল—আরও অসহ্য।\n\nএকটু রাগ কম করেন প্লিজ। কিছু বললেই মনে হয়, রাগ করবেন আবার। একটু তো দয়া করেন। না করলেও হবে।\n\nআরেকটু বেশি কথা বলেন আমার সাথে? রাত হলেই মনে হয় আপনি কল দিবেন—কিন্তু দিচ্ছেন না অনেকদিন। বাড়িতে গেছেন, বুঝতে পারছি।\n\nশুনুন, আপনার জন্য আমি প্রচুর দোয়া করি। আপনার প্রতিটা স্বপ্ন পূরণ হোক। আপনি খুব সুখী হবেন—আমি সেটাই চাই।\n\nআমি চাই, সেই সুখে আমি যেন পাশে থাকতে পারি। আর না পারলেও—চাই আপনি সুখী থাকুন।\n\nআপনি আমাকে কতটা ভালোবাসতেন—এখন সেই অভাবটা বুঝতে পারি। আল্লাহ চাইলে আবার কোনো একদিন। এখন সব চাওয়া উনার কাছেই। দেখা যাক, উনি কোনটা ঠিক মনে করেন।\n\nআপনিও আমার জন্য দোয়া করবেন—যেন আমি আপনার যোগ্য হয়ে উঠতে পারি।\n\nআরও অনেক কিছু লিখতে ইচ্ছে করছে, কিন্তু অনেক বড় হয়ে যাবে।\n\nও হ্যাঁ—আজকের কাহিনি বলি। আজ আপনাকে স্বপ্নে দেখেছি। দেখি, আমার আর আপনার বিয়ে নিয়ে কথা হচ্ছে। সকাল থেকে আমার ঈদের মতো লাগছে।\n\nআরও অনেক কথা আছে—সেগুলো জানতে ইনবক্স করুন (হেহে)। নাহয় আরেকটা বানাবো—চিঠি সাইট।\n\nএকসময় এইসব ওয়েবসাইট একটা ডোমেইন কিনে মার্জ করবো। সেরা না? আপনি সেরা—এইসব তো সেরাই হবে।\n\nঅনুগ্রহপূর্বক আমার আবেদনগুলো মেনে নেবেন।\n\nনিবেদক,\n\nআপনার একান্ত অনুগত\n\nRokto",

  memories_drive_link:
    "https://drive.google.com/drive/folders/1vqbn5U8dTdpsnn3gjJoad8_HdPrrCAtY?usp=sharing",
  background_color: "#FAF8F5",
  accent_color: "#E8D5C4",
  text_color: "#4A4A4A",
  font_family: "Noto Serif Bengali",
  font_size: 19,
};

function scrollToSection(sectionId) {
  const section = document.getElementById(sectionId);
  if (section) {
    section.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}

async function onConfigChange(config) {
  const openingMessage =
    config.opening_message || defaultConfig.opening_message;
  const letterRecipient =
    config.letter_recipient || defaultConfig.letter_recipient;
  const letterContent = config.letter_content || defaultConfig.letter_content;
  const letterClosing = config.letter_closing || defaultConfig.letter_closing;
  const driveLink =
    config.memories_drive_link || defaultConfig.memories_drive_link;
  const backgroundColor =
    config.background_color || defaultConfig.background_color;
  const accentColor = config.accent_color || defaultConfig.accent_color;
  const textColor = config.text_color || defaultConfig.text_color;
  const fontFamily = config.font_family || defaultConfig.font_family;
  const fontSize = config.font_size || defaultConfig.font_size;

  // Update opening message
  document.getElementById("opening-message-text").textContent = openingMessage;
  document.getElementById("opening-message-text").style.color = textColor;
  document.getElementById(
    "opening-message-text"
  ).style.fontFamily = `${fontFamily}, serif`;

  // Update letter
  document.getElementById(
    "letter-recipient"
  ).textContent = `Dear ${letterRecipient},`;
  document.getElementById("letter-recipient").style.color = textColor;
  document.getElementById(
    "letter-recipient"
  ).style.fontFamily = `${fontFamily}, serif`;

  const letterBody = document.getElementById("letter-body");
  letterBody.innerHTML = "";
  const paragraphs = letterContent.split("\n\n");
  paragraphs.forEach((para) => {
    if (para.trim()) {
      const p = document.createElement("p");
      p.textContent = para.trim();
      p.style.color = textColor;
      p.style.fontFamily = `${fontFamily}, serif`;
      p.style.fontSize = `${fontSize}px`;
      letterBody.appendChild(p);
    }
  });

  document.getElementById("letter-closing").textContent = letterClosing;
  document.getElementById("letter-closing").style.color = textColor;
  document.getElementById(
    "letter-closing"
  ).style.fontFamily = `${fontFamily}, serif`;

  // Update drive link
  document.getElementById("drive-link").href = driveLink;

  // Update colors
  document.body.style.backgroundColor = backgroundColor;
  document.body.style.color = textColor;
  document.body.style.fontFamily = `${fontFamily}, serif`;

  // Update timeline dots
  const timelineDots = document.querySelectorAll(".timeline-item::before");
  document.documentElement.style.setProperty("--accent-color", accentColor);
}

if (window.elementSdk) {
  window.elementSdk.init({
    defaultConfig,
    onConfigChange,
    mapToCapabilities: (config) => ({
      recolorables: [
        {
          get: () => config.background_color || defaultConfig.background_color,
          set: (value) => {
            config.background_color = value;
            window.elementSdk.setConfig({ background_color: value });
          },
        },
        {
          get: () => config.text_color || defaultConfig.text_color,
          set: (value) => {
            config.text_color = value;
            window.elementSdk.setConfig({ text_color: value });
          },
        },
        {
          get: () => config.accent_color || defaultConfig.accent_color,
          set: (value) => {
            config.accent_color = value;
            window.elementSdk.setConfig({ accent_color: value });
          },
        },
      ],
      borderables: [],
      fontEditable: {
        get: () => config.font_family || defaultConfig.font_family,
        set: (value) => {
          config.font_family = value;
          window.elementSdk.setConfig({ font_family: value });
        },
      },
      fontSizeable: {
        get: () => config.font_size || defaultConfig.font_size,
        set: (value) => {
          config.font_size = value;
          window.elementSdk.setConfig({ font_size: value });
        },
      },
    }),
    mapToEditPanelValues: (config) =>
      new Map([
        [
          "opening_message",
          config.opening_message || defaultConfig.opening_message,
        ],
        [
          "letter_recipient",
          config.letter_recipient || defaultConfig.letter_recipient,
        ],
        [
          "letter_content",
          config.letter_content || defaultConfig.letter_content,
        ],
        [
          "letter_closing",
          config.letter_closing || defaultConfig.letter_closing,
        ],
        [
          "memories_drive_link",
          config.memories_drive_link || defaultConfig.memories_drive_link,
        ],
      ]),
  });

  onConfigChange(window.elementSdk.config);
} else {
  onConfigChange(defaultConfig);
}

(function () {
  function c() {
    var b = a.contentDocument || a.contentWindow.document;
    if (b) {
      var d = b.createElement("script");
      d.innerHTML =
        "window.__CF$cv$params={r:'9b62c15eb0a78c28',t:'MTc2NzExMDQ4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
      b.getElementsByTagName("head")[0].appendChild(d);
    }
  }
  if (document.body) {
    var a = document.createElement("iframe");
    a.height = 1;
    a.width = 1;
    a.style.position = "absolute";
    a.style.top = 0;
    a.style.left = 0;
    a.style.border = "none";
    a.style.visibility = "hidden";
    document.body.appendChild(a);
    if ("loading" !== document.readyState) c();
    else if (window.addEventListener)
      document.addEventListener("DOMContentLoaded", c);
    else {
      var e = document.onreadystatechange || function () {};
      document.onreadystatechange = function (b) {
        e(b);
        "loading" !== document.readyState &&
          ((document.onreadystatechange = e), c());
      };
    }
  }
})();
